<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction • sixs</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction">
<meta property="og:description" content="sixs">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sixs</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/multiple.html">Processing multiple images</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction</h1>
            
      
      
      <div class="hidden name"><code>intro.Rmd</code></div>

    </div>

    
    
<div id="purpose" class="section level2">
<h2 class="hasAnchor">
<a href="#purpose" class="anchor"></a>Purpose</h2>
<p>The <code>sixs</code> package automates obtaining atmospheric correction parameters by programmatically filling up the <a href="https://www-loa.univ-lille1.fr/Wsixs/">web interface</a> with user-provided inputs, as well as related functions to aid in atmospheric correction of satellite images in general, and Venus satellite images in particular.</p>
</div>
<div id="package-structure" class="section level2">
<h2 class="hasAnchor">
<a href="#package-structure" class="anchor"></a>Package structure</h2>
<p>The main two functions in the package are:</p>
<ul>
<li>
<code>sixs_params</code> for obtaining the 6S parameters</li>
<li>
<code>toa_rad_to_boa_refl</code> for convering a TOA radiance image to a BOA reflectance image using the 6S parameters</li>
</ul>
<p>The package also contains several other functions, :</p>
<ul>
<li>
<code>get_venus_metadata</code> for extracting relevant Venus satellite image metadata from <code>HDR</code> files</li>
<li>
<code>rad_to_refl</code> for converting TOA radiance to TOA reflectance</li>
<li>
<code>refl_to_rad</code> for converting TOA reflectance to TOA radiance</li>
</ul>
<p>Two datasets are provided to for the reproducible examples (below, and in package docs) to demonstrate atmospheric correction of Venus satellite images:</p>
<ul>
<li>
<code>venus1</code> - a raw (cropped) Venus satellite image (<code>stars</code> object), given in TOA reflectance</li>
<li>
<code>venus1_boa</code> - an atmospherically-corrected image (<code>stars</code> object), given in BOA reflectance</li>
<li>
<code>venus1m</code> - raw venus image metadata, the contents of the <code>HDR</code> file (<code>character</code>)</li>
<li>
<code>venus2</code>, <code>venus2_boa</code>, <code>venus2m</code> - same, for a different Venus image</li>
<li>
<code>bands</code> - general information on Venus satellite bands (<code>data.frame</code>)</li>
<li>
<code>venus_validation</code> - parameters from the metadata and from the 6S website for all 12 bands of both images, for validation purposes</li>
</ul>
</div>
<div id="setup" class="section level2">
<h2 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h2>
<div id="installing-the-package" class="section level3">
<h3 class="hasAnchor">
<a href="#installing-the-package" class="anchor"></a>Installing the package</h3>
<p>Package <code>sixs</code> can be installed from GitHub as follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"michaeldorman/sixs"</span><span class="op">)</span></pre></div>
</div>
<div id="setting-up-a-selenium-server" class="section level3">
<h3 class="hasAnchor">
<a href="#setting-up-a-selenium-server" class="anchor"></a>Setting up a Selenium server</h3>
<div id="overview" class="section level4">
<h4 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h4>
<p>Running the <code>sixs_params</code> function, to get the 6S parameters, requires a Selenium server. The server connection needs to be passed as a parameter named <code>remote_driver</code> to the <code>sixs_params</code> function.</p>
<p>The recommended way to run a Selenium server is through docker. Detailed instructions on how to do that can be found in the <a href="https://cran.r-project.org/web/packages/RSelenium/vignettes/docker.html">Docker vignette</a> of package <code>RSelenium</code>.</p>
</div>
<div id="local-server" class="section level4">
<h4 class="hasAnchor">
<a href="#local-server" class="anchor"></a>Local server</h4>
<p>You can start your own local server, for example using the following expression on the command line (Ubuntu 18.04):</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" title="1"><span class="ex">docker</span> run -d -p 4445:4444 selenium/standalone-firefox:2.53.1</a></code></pre></div>
<p>then connecting to the server from R to create the <code>remote_driver</code> object:</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://docs.ropensci.org/RSelenium">RSelenium</a></span><span class="op">)</span>
<span class="va">remote_driver</span> <span class="op">=</span> <span class="fu"><a href="https://docs.ropensci.org/RSelenium/reference/remoteDriver-class.html">remoteDriver</a></span><span class="op">(</span>remoteServerAddr <span class="op">=</span> <span class="st">"localhost"</span>, port <span class="op">=</span> <span class="fl">4445L</span><span class="op">)</span>
<span class="va">remote_driver</span><span class="op">$</span><span class="fu">open</span><span class="op">(</span>silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></pre></div>
</div>
<div id="demo-server" class="section level4">
<h4 class="hasAnchor">
<a href="#demo-server" class="anchor"></a>Demo server</h4>
<p>Alternatively, you can use the demo server we set up for demontrating the package. Here is a small example where we browse to <a href="https://www.google.com">https://www.google.com</a> and print the page title:</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://docs.ropensci.org/RSelenium">RSelenium</a></span><span class="op">)</span>

<span class="co"># Remote driver</span>
<span class="va">remote_driver</span> <span class="op">=</span> <span class="fu"><a href="https://docs.ropensci.org/RSelenium/reference/remoteDriver-class.html">remoteDriver</a></span><span class="op">(</span>remoteServerAddr <span class="op">=</span> <span class="st">"164.90.191.95"</span>, port <span class="op">=</span> <span class="fl">4445L</span><span class="op">)</span>

<span class="co"># Open</span>
<span class="va">remote_driver</span><span class="op">$</span><span class="fu">open</span><span class="op">(</span>silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># Browse to google.com &amp; print page title</span>
<span class="va">remote_driver</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"https://www.google.com"</span><span class="op">)</span>
<span class="va">remote_driver</span><span class="op">$</span><span class="fu">getTitle</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] "Google"</span>

<span class="co"># Close</span>
<span class="va">remote_driver</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></pre></div>
<p>Note that the connection needs to be closed at the end using the last expression above. Keeping the connection open consumes RAM and eventually can make the server crash! The demo server is restarted automatically every day at 4AM. If you encounter a problem, please open an <a href="https://github.com/michaeldorman/sixs/issues">issue</a>.</p>
</div>
</div>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<div id="overview-1" class="section level3">
<h3 class="hasAnchor">
<a href="#overview-1" class="anchor"></a>Overview</h3>
<p>The following sections demonstrate the entire process of going from a raw TOA reflectance Venus satellite image to an atmospherically-corrected BOA reflectance image.</p>
</div>
<div id="input-data" class="section level3">
<h3 class="hasAnchor">
<a href="#input-data" class="anchor"></a>Input data</h3>
<p>The input data includes:</p>
<ol style="list-style-type: decimal">
<li>The Venus satellite image fragment (<code>venus1</code>)</li>
<li>The Venus satellite image metadata (<code>venus1m</code>)</li>
<li>Venus bands metadata (<code>bands</code>)</li>
</ol>
<p>First, we load the <code>sixs</code> package:</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">sixs</span><span class="op">)</span>
<span class="co">#&gt; Loading required package: stars</span>
<span class="co">#&gt; Loading required package: abind</span>
<span class="co">#&gt; Loading required package: sf</span>
<span class="co">#&gt; Linking to GEOS 3.8.1, GDAL 3.1.3, PROJ 7.1.1</span></pre></div>
<p>Here is a printout of the raw Venus image fragment, <code>venus1</code>. The object contains the original information from the <code>.tif</code> file, cropped to a small spatial extent (to reduce image size) and using only the reflective bands 1-12:</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="va">venus1</span>
<span class="co">#&gt; stars object with 3 dimensions and 1 attribute</span>
<span class="co">#&gt; attribute(s):</span>
<span class="co">#&gt;      refl       </span>
<span class="co">#&gt;  Min.   : 31.0  </span>
<span class="co">#&gt;  1st Qu.:110.0  </span>
<span class="co">#&gt;  Median :150.0  </span>
<span class="co">#&gt;  Mean   :174.8  </span>
<span class="co">#&gt;  3rd Qu.:227.0  </span>
<span class="co">#&gt;  Max.   :599.0  </span>
<span class="co">#&gt;  NA's   :2892   </span>
<span class="co">#&gt; dimension(s):</span>
<span class="co">#&gt;      from  to  offset delta                refsys point values x/y</span>
<span class="co">#&gt; x       1 121  736830     5 WGS_1984_UTM_Zone_36N FALSE   NULL [x]</span>
<span class="co">#&gt; y       1 121 3639028    -5 WGS_1984_UTM_Zone_36N FALSE   NULL [y]</span>
<span class="co">#&gt; band    1  12      NA    NA                    NA    NA   NULL</span></pre></div>
<p>and here is a visualization. Note that the image includes six (reflective) bands 1-12:</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="fu"><a href="https://r-spatial.github.io/stars/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">venus1</span><span class="op">)</span></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-7-1.png" width="576" style="display: block; margin: auto;"></p>
<p>In case you are working with a real Venus image, rather than the sample dataset, the <code>.TIF</code> file can be read into a <code>stars</code> object with:</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/">stars</a></span><span class="op">)</span>

<span class="co"># Read image</span>
<span class="va">r</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/read_stars.html">read_stars</a></span><span class="op">(</span><span class="st">"/home/michael/Dropbox/Packages/sixs/other/venus_sample_data/images/VE_VM01_VSC_PDTIMG_L1VALD_ISRAEL03_20190204.DBL.TIF_crop.TIF"</span>, proxy <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># Subset bands</span>
<span class="va">r</span> <span class="op">=</span> <span class="va">r</span><span class="op">[</span>,,,<span class="fl">1</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span></pre></div>
<p>The Venus image metadata comes as an XML document in an <code>.HDR</code> file. File contents are stored as a <code>character</code> of length 1 named <code>venus1m</code>. Here are the first 80 characters from it:</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">venus1m</span>, <span class="fl">1</span>, <span class="fl">80</span><span class="op">)</span>
<span class="co">#&gt; [1] "&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;?xml-stylesheet type='text/xsl' href='DIS"</span></pre></div>
<p>Additionally, the <code>sixs</code> package includes general metadata about the 12 reflective bands of the Venus satellite, in a <code>data.frame</code> named <code>bands</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="va">bands</span>
<span class="co">#&gt;    band   lower   upper     esun</span>
<span class="co">#&gt; 1     1 0.40399 0.44399 1661.634</span>
<span class="co">#&gt; 2     2 0.42690 0.46690 1954.005</span>
<span class="co">#&gt; 3     3 0.47190 0.51190 1990.678</span>
<span class="co">#&gt; 4     4 0.53500 0.57500 1830.509</span>
<span class="co">#&gt; 5     5 0.59970 0.63970 1669.217</span>
<span class="co">#&gt; 6     6 0.59950 0.63950 1670.402</span>
<span class="co">#&gt; 7     7 0.65120 0.68120 1510.949</span>
<span class="co">#&gt; 8     8 0.69000 0.71400 1428.368</span>
<span class="co">#&gt; 9     9 0.73310 0.74910 1290.557</span>
<span class="co">#&gt; 10   10 0.77420 0.79020 1163.151</span>
<span class="co">#&gt; 11   11 0.84110 0.88110  965.547</span>
<span class="co">#&gt; 12   12 0.89870 0.91870  879.865</span></pre></div>
</div>
<div id="getting-image-metadata" class="section level3">
<h3 class="hasAnchor">
<a href="#getting-image-metadata" class="anchor"></a>Getting image metadata</h3>
<p>The first step is to process the <code>HDR</code> metadata <code>character</code> into a <code>list</code> (using the <code>XML</code> package), then extract the relevant metadata items to another (smaller) <code>list</code> using <code>get_venus_metadata</code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.omegahat.net/RSXML">XML</a></span><span class="op">)</span>
<span class="va">l</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/XML/man/xmlToList.html">xmlToList</a></span><span class="op">(</span><span class="va">venus1m</span><span class="op">)</span>
<span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_venus_metadata.html">get_venus_metadata</a></span><span class="op">(</span><span class="va">l</span>, band <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></pre></div>
<p>Here is the list with metadata items that we now have:</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="va">m</span>
<span class="co">#&gt; $date</span>
<span class="co">#&gt; [1] "2019-02-04"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $solar_zenith_angle</span>
<span class="co">#&gt; [1] 52.45633</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $solar_azimuth_angle</span>
<span class="co">#&gt; [1] 156.2326</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $view_zenith_angle</span>
<span class="co">#&gt; [1] 12.8512</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $view_azimuth_angle</span>
<span class="co">#&gt; [1] 168.3401</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $longitude</span>
<span class="co">#&gt; [1] 35.52071</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $latitude</span>
<span class="co">#&gt; [1] 32.95559</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $elevation</span>
<span class="co">#&gt; [1] 0.325</span></pre></div>
<p>In case you are working with a real Venus image, rather thean the sample dataset, the same result can be obtained reading from the <code>.HDR</code> file:</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.omegahat.net/RSXML">XML</a></span><span class="op">)</span>
<span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/XML/man/xmlTreeParse.html">xmlParse</a></span><span class="op">(</span><span class="st">"VE_VM01_VSC_L1VALD_ISRAEL03_20190204.HDR"</span><span class="op">)</span>
<span class="va">l</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/XML/man/xmlToList.html">xmlToList</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_venus_metadata.html">get_venus_metadata</a></span><span class="op">(</span><span class="va">l</span>, band <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></pre></div>
</div>
<div id="reflectance-to-radiance" class="section level3">
<h3 class="hasAnchor">
<a href="#reflectance-to-radiance" class="anchor"></a>Reflectance to radiance</h3>
<p>Venus satellite images are provided in TOA reflectance values, multiplied by 1000. However, the 6S algorithm requires the input to be TOA radiance values.</p>
<p>Therefore, to proceed, the Venus image values need to be divided by 1000:</p>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="va">venus1</span> <span class="op">=</span> <span class="va">venus1</span> <span class="op">*</span> <span class="fl">0.001</span></pre></div>
<p>In the example, we atmospherically correct a specific band (3), therefore we will also subset the third layer from the <code>venus1</code> image:</p>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="va">venus1</span> <span class="op">=</span> <span class="va">venus1</span><span class="op">[</span>,,,<span class="fl">3</span>,drop<span class="op">=</span><span class="cn">TRUE</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">venus1</span><span class="op">)</span> <span class="op">=</span> <span class="st">"TOA reflectance"</span></pre></div>
<p>Here is what the TOA reflectance values in band 3 of the <code>venus1</code> sample image look like:</p>
<div class="sourceCode" id="cb16"><pre class="downlit">
<span class="fu"><a href="https://r-spatial.github.io/stars/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">venus1</span><span class="op">)</span></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-16-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Now, the TOA reflectance values need to be converted back to TOA radiance values (so that they can be used as input in the 6S algorithm). The conversion from TOA reflectance to TOA radiance can be done using function <code>refl_to_rad</code>.</p>
<p>Here is an example of converting the band 3 of the <code>venus1</code> image from TOA reflectance to TOA radiance:</p>
<div class="sourceCode" id="cb17"><pre class="downlit">
<span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_venus_metadata.html">get_venus_metadata</a></span><span class="op">(</span><span class="va">l</span>, band <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="va">venus1_toa_rad</span> <span class="op">=</span> <span class="fu"><a href="../reference/refl_to_rad.html">refl_to_rad</a></span><span class="op">(</span>
  toa_refl <span class="op">=</span> <span class="va">venus1</span>,
  date <span class="op">=</span> <span class="va">m</span><span class="op">$</span><span class="va">date</span>,
  esun <span class="op">=</span> <span class="va">bands</span><span class="op">$</span><span class="va">esun</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,
  solar_zenith_angle <span class="op">=</span> <span class="va">m</span><span class="op">$</span><span class="va">solar_zenith_angle</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">venus1_toa_rad</span><span class="op">)</span> <span class="op">=</span> <span class="st">"Band 3, TOA radiance"</span></pre></div>
<p>And here is an image of the result:</p>
<div class="sourceCode" id="cb18"><pre class="downlit">
<span class="fu"><a href="https://r-spatial.github.io/stars/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">venus1_toa_rad</span><span class="op">)</span></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-18-1.png" width="576" style="display: block; margin: auto;"></p>
<p>(When the satellite image is given in radiance units, the inverse <code>rad_to_refl</code> function can be used to convert it to a TOA reflectance image—if necessary. The required data includes the <code>date</code>, <code>esun</code> and <code>solar_zenith_angle</code>, same as in <code>refl_to_rad</code>.)</p>
</div>
<div id="atmospheric-parameters-from-aeronet" class="section level3">
<h3 class="hasAnchor">
<a href="#atmospheric-parameters-from-aeronet" class="anchor"></a>Atmospheric parameters from AERONET</h3>
<p>In addition to the Venus image metadata extracted from the <code>.HDR</code> file and the general information in the <code>bands</code> table, the 6S algorithm also requires obtaining three meteorological parameters from the AERONET stations data, namely:</p>
<ul>
<li>AOD 550nm</li>
<li>Uw [g cm-2]</li>
<li>UO3 [cm/atm]</li>
</ul>
<p>Here is how to obtain these parameters:</p>
<ul>
<li><p>Navigate to the AERONET <a href="https://aeronet.gsfc.nasa.gov/cgi-bin/draw_map_display_aod_v3">web page</a> to open the available data from AERONET stations worldwide.</p></li>
<li><p>Choose an AEORONET station that is geographically located near your site. It is possible to click on the map several times in order to zoom in and choose the relevant station easily. For example, the screenshot below shows a list of AERONET stations in the western Middle East (Israel, Egypt, Cyprus and Greece).</p></li>
</ul>
<div class="figure" style="text-align: center">
<img src="fig1.png" alt="Example of a list of AERONET stations" width="362"><p class="caption">
Example of a list of AERONET stations
</p>
</div>
<ul>
<li>Click on the relevant station. This will open a window as shown in the following screenshot.</li>
</ul>
<div class="figure" style="text-align: center">
<img src="fig2.png" alt="A window of meteorological data for Sede Boker site in Israel. The links for downloading the relevant data are shown in red squares" width="491"><p class="caption">
A window of meteorological data for Sede Boker site in Israel. The links for downloading the relevant data are shown in red squares
</p>
</div>
<ul>
<li><p>Choose the relevant period (year) on the left panel. In case the user does not choose the relevant period, the website will return data for the current year as a default. Another option is to choose a specific relevant day on the right panel; however, it this is not useful for atmospheric correction of satellite imagery since these corrections require a daily temporal resolution and not hourly.</p></li>
<li><p>Click on AOD Level 1.0 to download the data.</p></li>
<li><p>Accept the data usage agreement.</p></li>
<li><p>Download and unzip the data (a <code>.lev1</code> file) and open the data in Excel using the option “from text” in the “data” tab.</p></li>
<li><p>Calculate the AOD in 550 nm: use the AOD in 675 nm (AOD_675nm column) and AOD in 500 nm (AOD_500nm column) in the formula below to calculate AOD in 550 nm:</p></li>
<li><p>Find the perceptible water value under the column “Precipitable_Water(cm)” that presents the water vapor (Uw) in [g cm-2].</p></li>
<li><p>Find the Ozone concentration value under the column “Ozone(Dobson)” that presents the O3 concentration in Dobson units. Multiply this value by 0.001 to obtain the Ozone concentration in [cm/atm].</p></li>
</ul>
<p>Specifically for the image we are working with in this example, <code>venus1</code>, the required parameters are:</p>
<div class="sourceCode" id="cb19"><pre class="downlit">
<span class="va">Uw</span> <span class="op">=</span> <span class="fl">0.665071</span>
<span class="va">Uo3</span> <span class="op">=</span> <span class="fl">0.2982371</span>
<span class="va">opticalDepth</span> <span class="op">=</span> <span class="fl">0.1105934</span></pre></div>
</div>
<div id="additional-parameters" class="section level3">
<h3 class="hasAnchor">
<a href="#additional-parameters" class="anchor"></a>Additional parameters</h3>
<p>Finally, there are some parameters required for the 6S algorithm that cannot be obtained from the image metadata or from the AERONET website. Instead, they need to be determined according to the purposes of image correction:</p>
<ul>
<li>
<code>GroundCondition</code> is usually <code>"Patchy Ground"</code>.</li>
<li>
<code>TargetReflectance</code> depends on what the project focuses on.</li>
<li>
<code>EnvironmentReflectance</code> depends on surrounding cover.</li>
<li>
<code>TargetRadius</code> needs to be smaller than pixel size, in meters (for Venus &lt;5.3)</li>
</ul>
<p>Here are the specific values we are going to use when correcting the <code>venus1</code> image:</p>
<div class="sourceCode" id="cb20"><pre class="downlit">
<span class="va">GroundCondition</span> <span class="op">=</span> <span class="st">"Patchy Ground"</span>
<span class="va">TargetReflectance</span> <span class="op">=</span> <span class="st">"Vegetation"</span>
<span class="va">EnvironmentReflectance</span> <span class="op">=</span> <span class="st">"Vegetation"</span> 
<span class="va">TargetRadius</span> <span class="op">=</span> <span class="fl">0.5</span></pre></div>
</div>
<div id="s-parameters" class="section level3">
<h3 class="hasAnchor">
<a href="#s-parameters" class="anchor"></a>6S parameters</h3>
<p>Once we have all of the parameters, the remote server is set and the <code>remote_driver</code> object exists, you can execute the <code>sixs_params</code> function to get the 6S parameters.</p>
<p>For example, for band 3 from the <code>venus1</code> image we get:</p>
<div class="sourceCode" id="cb21"><pre class="downlit">
<span class="va">remote_driver</span><span class="op">$</span><span class="fu">open</span><span class="op">(</span>silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">xcoefficients</span> <span class="op">=</span> <span class="fu"><a href="../reference/sixs_params.html">sixs_params</a></span><span class="op">(</span>
  remote_driver <span class="op">=</span> <span class="va">remote_driver</span>, 
  day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">m</span><span class="op">$</span><span class="va">date</span>, <span class="st">"%d"</span><span class="op">)</span><span class="op">)</span>,
  month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">m</span><span class="op">$</span><span class="va">date</span>, <span class="st">"%m"</span><span class="op">)</span><span class="op">)</span>, 
  SolarZenithalAngle <span class="op">=</span> <span class="va">m</span><span class="op">$</span><span class="va">solar_zenith_angle</span>, 
  SolarAzimuthalAngle <span class="op">=</span> <span class="va">m</span><span class="op">$</span><span class="va">solar_azimuth_angle</span>,
  ViewZenithalAngle <span class="op">=</span> <span class="va">m</span><span class="op">$</span><span class="va">view_zenith_angle</span>,
  ViewAzimuthalAngle <span class="op">=</span> <span class="va">m</span><span class="op">$</span><span class="va">view_azimuth_angle</span>, 
  Longitude <span class="op">=</span> <span class="va">m</span><span class="op">$</span><span class="va">longitude</span>, 
  Latitude <span class="op">=</span> <span class="va">m</span><span class="op">$</span><span class="va">latitude</span>, 
  Uw <span class="op">=</span> <span class="fl">0.665071</span>, 
  Uo3 <span class="op">=</span> <span class="fl">0.2982371</span>, 
  opticalDepth <span class="op">=</span> <span class="fl">0.1105934</span>, 
  LowerWavelength <span class="op">=</span> <span class="va">bands</span><span class="op">$</span><span class="va">lower</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, 
  UpperWavelength <span class="op">=</span> <span class="va">bands</span><span class="op">$</span><span class="va">upper</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,
  TargetAltitude <span class="op">=</span> <span class="va">m</span><span class="op">$</span><span class="va">elevation</span>,
  GroundCondition <span class="op">=</span> <span class="st">"Patchy Ground"</span>,
  TargetReflectance <span class="op">=</span> <span class="st">"Vegetation"</span>,
  EnvironmentReflectance <span class="op">=</span> <span class="st">"Vegetation"</span>, 
  TargetRadius <span class="op">=</span> <span class="fl">0.5</span>
<span class="op">)</span>
<span class="co">#&gt; Step 1 - Geometrical Conditions</span>
<span class="co">#&gt; Step 2 - Atmospheric Model</span>
<span class="co">#&gt; Step 3 - Spectral Conditions</span>
<span class="co">#&gt; Step 4 - Target &amp; Sensor Altitude</span>
<span class="co">#&gt; Step 5 - Ground Reflectance</span>
<span class="co">#&gt; Step 6 - Signal Source</span>
<span class="va">remote_driver</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></pre></div>
<p>You can use the <code>.screenshot=TRUE</code> parameter in the above function call for viewing the web interface throughout the process. This will create a temporary file named <code>rselenium_screenshot.png</code> in the current working directory.</p>
<p>The result is a named numeric vector with the 6S parameter values, valid for band 3 of the <code>venus1</code> image:</p>
<div class="sourceCode" id="cb22"><pre class="downlit">
<span class="va">xcoefficients</span>
<span class="co">#&gt;      xa      xb      xc </span>
<span class="co">#&gt; 0.00369 0.11777 0.12263</span></pre></div>
</div>
<div id="toa-to-boa" class="section level3">
<h3 class="hasAnchor">
<a href="#toa-to-boa" class="anchor"></a>TOA to BOA</h3>
<p>Finally, using the 6S parameters we can convert the TOA radiance image (band 3) to a BOA reflectance image, using function <code>toa_rad_to_boa_refl</code>. We are using the <code>xcoefficients</code>, which contains the parameters we obtained from the 6S website in the previous step:</p>
<div class="sourceCode" id="cb23"><pre class="downlit">
<span class="va">venus1_boa_refl</span> <span class="op">=</span> <span class="fu"><a href="../reference/toa_rad_to_boa_refl.html">toa_rad_to_boa_refl</a></span><span class="op">(</span>
  toa_rad <span class="op">=</span> <span class="va">venus1_toa_rad</span>, 
  params <span class="op">=</span> <span class="va">xcoefficients</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">venus1_boa_refl</span><span class="op">)</span> <span class="op">=</span> <span class="st">"Band 3, BOA reflectance"</span></pre></div>
<p>Here is the result, BOA reflectance in band 3 of the Venus image with started with (<code>venus1</code>):</p>
<div class="sourceCode" id="cb24"><pre class="downlit">
<span class="fu"><a href="https://r-spatial.github.io/stars/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">venus1_boa_refl</span><span class="op">)</span></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-24-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="correcting-all-12-bands" class="section level3">
<h3 class="hasAnchor">
<a href="#correcting-all-12-bands" class="anchor"></a>Correcting all 12 bands</h3>
<p>The following code section repeats the steps demonstrated above, but executing them sequentially for each of the 12 bands, rather than just for band 3, using a <code>for</code> loop:</p>
<div class="sourceCode" id="cb25"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">sixs</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.omegahat.net/RSXML">XML</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://docs.ropensci.org/RSelenium">RSelenium</a></span><span class="op">)</span>

<span class="co"># Get image metadata</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">venus1m</span><span class="op">)</span>
<span class="va">l</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/XML/man/xmlToList.html">xmlToList</a></span><span class="op">(</span><span class="va">venus1m</span><span class="op">)</span>

<span class="co"># Empty list to keep results</span>
<span class="va">result</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>

<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span> <span class="op">{</span>

  <span class="co"># Rescale and select band</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">venus1</span><span class="op">)</span>
  <span class="va">venus1</span> <span class="op">=</span> <span class="va">venus1</span> <span class="op">*</span> <span class="fl">0.001</span>
  <span class="va">venus1</span> <span class="op">=</span> <span class="va">venus1</span><span class="op">[</span>,,,<span class="va">i</span>,drop<span class="op">=</span><span class="cn">TRUE</span><span class="op">]</span>

  <span class="co"># Get image band metadata</span>
  <span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_venus_metadata.html">get_venus_metadata</a></span><span class="op">(</span><span class="va">l</span>, band <span class="op">=</span> <span class="va">i</span><span class="op">)</span>

  <span class="co"># Convert TOA reflectance to TOA radiance</span>
  <span class="va">venus1_toa_rad</span> <span class="op">=</span> <span class="fu"><a href="../reference/refl_to_rad.html">refl_to_rad</a></span><span class="op">(</span>
    toa_refl <span class="op">=</span> <span class="va">venus1</span>,
    date <span class="op">=</span> <span class="va">m</span><span class="op">$</span><span class="va">date</span>,
    esun <span class="op">=</span> <span class="va">bands</span><span class="op">$</span><span class="va">esun</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,
    solar_zenith_angle <span class="op">=</span> <span class="va">m</span><span class="op">$</span><span class="va">solar_zenith_angle</span>
  <span class="op">)</span>

  <span class="co"># Get 6S parameters</span>
  <span class="va">remote_driver</span> <span class="op">=</span> <span class="fu"><a href="https://docs.ropensci.org/RSelenium/reference/remoteDriver-class.html">remoteDriver</a></span><span class="op">(</span>remoteServerAddr <span class="op">=</span> <span class="st">"164.90.191.95"</span>, port <span class="op">=</span> <span class="fl">4445L</span><span class="op">)</span>
  <span class="va">remote_driver</span><span class="op">$</span><span class="fu">open</span><span class="op">(</span>silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">xcoefficients</span> <span class="op">=</span> <span class="fu"><a href="../reference/sixs_params.html">sixs_params</a></span><span class="op">(</span>
    remote_driver <span class="op">=</span> <span class="va">remote_driver</span>, 
    day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">m</span><span class="op">$</span><span class="va">date</span>, <span class="st">"%d"</span><span class="op">)</span><span class="op">)</span>,
    month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">m</span><span class="op">$</span><span class="va">date</span>, <span class="st">"%m"</span><span class="op">)</span><span class="op">)</span>, 
    SolarZenithalAngle <span class="op">=</span> <span class="va">m</span><span class="op">$</span><span class="va">solar_zenith_angle</span>, 
    SolarAzimuthalAngle <span class="op">=</span> <span class="va">m</span><span class="op">$</span><span class="va">solar_azimuth_angle</span>,
    ViewZenithalAngle <span class="op">=</span> <span class="va">m</span><span class="op">$</span><span class="va">view_zenith_angle</span>,
    ViewAzimuthalAngle <span class="op">=</span> <span class="va">m</span><span class="op">$</span><span class="va">view_azimuth_angle</span>, 
    Longitude <span class="op">=</span> <span class="va">m</span><span class="op">$</span><span class="va">longitude</span>, 
    Latitude <span class="op">=</span> <span class="va">m</span><span class="op">$</span><span class="va">latitude</span>, 
    Uw <span class="op">=</span> <span class="fl">0.665071</span>, 
    Uo3 <span class="op">=</span> <span class="fl">0.2982371</span>, 
    opticalDepth <span class="op">=</span> <span class="fl">0.1105934</span>, 
    LowerWavelength <span class="op">=</span> <span class="va">bands</span><span class="op">$</span><span class="va">lower</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, 
    UpperWavelength <span class="op">=</span> <span class="va">bands</span><span class="op">$</span><span class="va">upper</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,
    TargetAltitude <span class="op">=</span> <span class="va">m</span><span class="op">$</span><span class="va">elevation</span>,
    GroundCondition <span class="op">=</span> <span class="st">"Patchy Ground"</span>,
    TargetReflectance <span class="op">=</span> <span class="st">"Vegetation"</span>,
    EnvironmentReflectance <span class="op">=</span> <span class="st">"Vegetation"</span>, 
    TargetRadius <span class="op">=</span> <span class="fl">0.5</span>,
    quiet <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span>
  <span class="va">remote_driver</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span>

  <span class="co"># Convert TOA radiance to BOA reflectance</span>
  <span class="va">venus1_boa_refl</span> <span class="op">=</span> <span class="fu"><a href="../reference/toa_rad_to_boa_refl.html">toa_rad_to_boa_refl</a></span><span class="op">(</span><span class="va">venus1_toa_rad</span>, <span class="va">xcoefficients</span><span class="op">)</span>

  <span class="co"># Add result to list</span>
  <span class="va">result</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="va">venus1_boa_refl</span>

<span class="op">}</span>

<span class="co"># Combine to multi-band raster</span>
<span class="va">result</span><span class="op">$</span><span class="va">along</span> <span class="op">=</span> <span class="fl">3</span>
<span class="va">result</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">c</span>, <span class="va">result</span><span class="op">)</span></pre></div>
<p>The image <code>result</code> is the final corrected image, now with all of the 12 bands (rather than just band 3):</p>
<div class="sourceCode" id="cb26"><pre class="downlit">
<span class="fu"><a href="https://r-spatial.github.io/stars/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-26-1.png" width="576" style="display: block; margin: auto;"></p>
<p>And here is an example of two reflectance profiles for a particular pixel (80,80) in the image. The original TOA reflectance profile is shown in red. The corrected BOA reflectance profile is shown in blue:</p>
<div class="sourceCode" id="cb27"><pre class="downlit">
<span class="co"># Extract reflectance profiles for one pixel</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">venus1</span><span class="op">)</span>
<span class="va">toa_refl1</span> <span class="op">=</span> <span class="va">venus1</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">80</span>,<span class="fl">80</span>,<span class="op">]</span> <span class="op">*</span> <span class="fl">0.001</span>
<span class="va">boa_refl1</span> <span class="op">=</span> <span class="va">result</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">80</span>,<span class="fl">80</span>,<span class="op">]</span>

<span class="co"># Plot profiles</span>
<span class="fu"><a href="https://r-spatial.github.io/stars/reference/plot.html">plot</a></span><span class="op">(</span>
  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">bands</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lower"</span>, <span class="st">"upper"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">toa_refl1</span>, 
  type <span class="op">=</span> <span class="st">"b"</span>, 
  xlab <span class="op">=</span> <span class="st">"Wavelength (micrometers)"</span>, 
  ylab <span class="op">=</span> <span class="st">"Reflectance"</span>, 
  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">toa_refl1</span>, <span class="va">boa_refl1</span><span class="op">)</span><span class="op">)</span>,
  col <span class="op">=</span> <span class="st">"red"</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>
  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">bands</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lower"</span>, <span class="st">"upper"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, 
  y <span class="op">=</span> <span class="va">boa_refl1</span>, 
  type <span class="op">=</span> <span class="st">"b"</span>, 
  col <span class="op">=</span> <span class="st">"blue"</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span>
  <span class="st">"bottomright"</span>,
  lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,
  legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TOA reflectance (original image)"</span>, <span class="st">"BOA reflectance (corrected)"</span><span class="op">)</span>, 
  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span><span class="op">)</span>
<span class="op">)</span></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-27-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Done!</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Michael Dorman, Moshe Dubinin, Shay Adar.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
